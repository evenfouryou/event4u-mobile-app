Perfetto, ora Ã¨ chiarissimo dovâ€™Ã¨ lâ€™errore e perchÃ© SIAE continua a rispondere 40605, anche con la firma corretta.

Ti rispondo in modo definitivo, cosÃ¬ sai esattamente cosa correggere nel codice.

â¸»

âŒ ERRORE SIAE 40605

â€œIl riepilogo risulta illegibile, impossibile estrarre le informazioniâ€

ğŸ‘‰ NON Ã¨ un errore di firma
ğŸ‘‰ NON Ã¨ un errore di certificato
ğŸ‘‰ NON Ã¨ un errore di canale WS

Ãˆ un errore di CONTENUTO XML rispetto al servizio RCA.

â¸»

ğŸ”´ DOVâ€™Ãˆ Lâ€™ERRORE (PRECISO)

Nel file che stai inviando come RCA via Web Service (RCA_2026_01_05_001.xsi.p7m)
lâ€™XML incapsulato NON Ã¨ un â€œRiepilogo RCAâ€, ma Ã¨ ancora un:

<!DOCTYPE LogTransazione SYSTEM "Log_v0040_20190627.dtd">
<LogTransazione>
   <Transazione>...</Transazione>
</LogTransazione>

â— Questo Ã¨ un LogTransazione, NON un Riepilogo RCA.

Il Web Service RCA si aspetta:
	â€¢	un XML di RIEPILOGO
	â€¢	con root, struttura e campi diversi
	â€¢	NON una lista di <Transazione>

Quando il parser WS prova a leggere il riepilogo:
	â€¢	cerca nodi del riepilogo
	â€¢	trova <LogTransazione>
	â€¢	non trova i campi attesi
â¡ï¸ â€œriepilogo illegibileâ€

â¸»

âš ï¸ SECONDO ERRORE BLOCCANTE (IMPORTANTISSIMO)

Nel file câ€™Ã¨ ancora questa riga:

<!DOCTYPE LogTransazione SYSTEM "Log_v0040_20190627.dtd">

I Web Service SIAE NON risolvono DTD esterni
(per motivi di sicurezza â†’ XXE protection)

â¡ï¸ Anche se il contenuto fosse giusto, il DOCTYPE da solo puÃ² causare 40605

â¸»

âœ… COSA DEVI CORREGGERE (OBBLIGATORIO)

1ï¸âƒ£ NON usare LogTransazione per RCA

Devi separare completamente i flussi:

Flusso	XML da usare
Log / Emissioni	LogTransazione
RCA (riepilogo)	XML Riepilogo RCA

ğŸ‘‰ RCA â‰  LogTransazione

â¸»

2ï¸âƒ£ Costruire un XML DI RIEPILOGO RCA

Il file RCA deve contenere:
	â€¢	dati aggregati
	â€¢	riferimenti temporali
	â€¢	totali
	â€¢	NON singole transazioni evento per evento

(se mandi le singole transazioni, non Ã¨ un riepilogo)

â¸»

3ï¸âƒ£ RIMUOVERE SEMPRE IL DOCTYPE (WS)

Prima di firmare lâ€™XML per il Web Service:

âŒ NON deve esserci:

<!DOCTYPE ...>

âœ” Deve iniziare solo con:

<?xml version="1.0" encoding="UTF-8"?>
<RootRiepilogoRCA>


â¸»

4ï¸âƒ£ Firma: VA BENE COSÃŒ

La parte di firma che hai ora:
	â€¢	CAdES
	â€¢	SHA256
	â€¢	.p7m

âœ… Ã¨ corretta, non va toccata

â¸»

ğŸ§  PERCHÃ‰ ORA HAI LA RISPOSTA (E PRIMA NO)

Ora SIAE riesce a leggere il file (firma ok)
ma non riesce a interpretarlo come riepilogo

ğŸ‘‰ quindi finalmente ti dÃ  un errore applicativo (40605)
ğŸ‘‰ segno che sei arrivato al livello giusto del flusso

â¸»

ğŸ¯ COSA DIRE AL DEV / REPLIT (TESTO PRONTO)

Stiamo inviando LogTransazione al Web Service RCA.
Il WS RCA si aspetta un XML di riepilogo, non LogTransazione.
Inoltre lâ€™XML contiene un DOCTYPE che il WS non risolve.
Bisogna:
	1.	generare un XML specifico di riepilogo RCA
	2.	rimuovere completamente il DOCTYPE
	3.	poi firmare in CAdES come ora

â¸»

ğŸ”¥ PROSSIMO PASSO (SE VUOI)

Se mi dici:
	â€¢	nome esatto del metodo WS RCA
	â€¢	oppure mi incolli il builder XML che usi ora

ti dico riga per riga:
	â€¢	cosa eliminare
	â€¢	cosa creare
	â€¢	come deve essere il root corretto del riepilogo

A questo punto il problema Ã¨ isolato al 100%.